<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Subinventario Selector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-6">Test: Selector de Subinventario</h1>
        
        <!-- Tipo de Inventario -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                Tipo de Inventario <span class="text-red-500">*</span>
            </label>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Inventario General -->
                <label class="relative block cursor-pointer">
                    <input 
                        type="radio" 
                        name="tipo_inventario" 
                        value="general" 
                        checked
                        class="radio-inventario sr-only"
                        onchange="toggleInventarioTipo()"
                    >
                    <div class="inventario-box p-4 bg-white border-2 border-gray-200 rounded-lg transition-all hover:border-blue-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="inventario-icon flex-shrink-0 w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-warehouse text-xl text-blue-600"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-900">Inventario General</p>
                                    <p class="text-sm text-gray-500">Stock disponible en bodega</p>
                                </div>
                            </div>
                            <div class="flex-shrink-0">
                                <div class="inventario-check w-6 h-6 border-2 border-gray-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-check text-xs text-white opacity-0"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </label>

                <!-- Subinventario -->
                <label class="relative block cursor-pointer">
                    <input 
                        type="radio" 
                        name="tipo_inventario" 
                        value="subinventario"
                        class="radio-inventario sr-only"
                        onchange="toggleInventarioTipo()"
                    >
                    <div class="inventario-box p-4 bg-white border-2 border-gray-200 rounded-lg transition-all hover:border-green-300">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="inventario-icon flex-shrink-0 w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-box-open text-xl text-green-600"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-900">Subinventario</p>
                                    <p class="text-sm text-gray-500">Stock asignado a punto de venta</p>
                                </div>
                            </div>
                            <div class="flex-shrink-0">
                                <div class="inventario-check w-6 h-6 border-2 border-gray-300 rounded-full flex items-center justify-center">
                                    <i class="fas fa-check text-xs text-white opacity-0"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </label>
            </div>
        </div>

        <!-- Selección de Subinventario -->
        <div id="subinventarioSelector" style="display: none;" class="mb-6">
            <label for="subinventario_id" class="block text-sm font-medium text-gray-700 mb-2">
                Seleccionar Subinventario <span class="text-red-500">*</span>
            </label>
            <div class="relative">
                <span class="absolute left-3 top-2.5 text-gray-400">
                    <i class="fas fa-box-open"></i>
                </span>
                <select 
                    name="subinventario_id" 
                    id="subinventario_id" 
                    class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                    onchange="cargarLibrosSubinventario()"
                >
                    <option value="">Selecciona un subinventario</option>
                    <option value="1">SubInventario #1 - Sucursal Norte (19/12/2025) - 5 libros</option>
                    <option value="2">SubInventario #2 - Sucursal Sur (18/12/2025) - 3 libros</option>
                    <option value="3">SubInventario #3 - Sucursal Centro (17/12/2025) - 8 libros</option>
                </select>
            </div>
            <p class="mt-2 text-sm text-green-600" id="statusMessage"></p>
        </div>

        <!-- Botón de prueba -->
        <div class="mb-6">
            <button 
                type="button" 
                id="addLibroBtn"
                class="px-4 py-2 bg-blue-600 text-white rounded-lg transition-all"
            >
                <i class="fas fa-plus mr-2"></i>
                Agregar Libro
            </button>
            <p class="mt-2 text-sm text-gray-600">
                El botón debe estar deshabilitado si seleccionas Subinventario pero no eliges uno específico.
            </p>
        </div>

        <!-- Log de eventos -->
        <div class="bg-gray-50 p-4 rounded-lg">
            <h3 class="font-semibold mb-2">Log de eventos:</h3>
            <div id="eventLog" class="text-sm text-gray-700 space-y-1"></div>
        </div>
    </div>

    <style>
        /* Inventario General - Azul */
        input[type="radio"][value="general"]:checked ~ .inventario-box {
            border-color: #3B82F6 !important;
            background-color: #EFF6FF !important;
        }
        input[type="radio"][value="general"]:checked ~ .inventario-box .inventario-icon {
            background-color: #3B82F6 !important;
        }
        input[type="radio"][value="general"]:checked ~ .inventario-box .inventario-icon i {
            color: white !important;
        }
        input[type="radio"][value="general"]:checked ~ .inventario-box .inventario-check {
            background-color: #3B82F6 !important;
            border-color: #3B82F6 !important;
        }
        input[type="radio"][value="general"]:checked ~ .inventario-box .inventario-check i {
            opacity: 1 !important;
        }
        
        /* Subinventario - Verde */
        input[type="radio"][value="subinventario"]:checked ~ .inventario-box {
            border-color: #10B981 !important;
            background-color: #ECFDF5 !important;
        }
        input[type="radio"][value="subinventario"]:checked ~ .inventario-box .inventario-icon {
            background-color: #10B981 !important;
        }
        input[type="radio"][value="subinventario"]:checked ~ .inventario-box .inventario-icon i {
            color: white !important;
        }
        input[type="radio"][value="subinventario"]:checked ~ .inventario-box .inventario-check {
            background-color: #10B981 !important;
            border-color: #10B981 !important;
        }
        input[type="radio"][value="subinventario"]:checked ~ .inventario-box .inventario-check i {
            opacity: 1 !important;
        }
    </style>

    <script>
        function logEvent(message) {
            const log = document.getElementById('eventLog');
            const time = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.textContent = `[${time}] ${message}`;
            log.insertBefore(entry, log.firstChild);
        }

        function toggleInventarioTipo() {
            const tipoInventario = document.querySelector('input[name="tipo_inventario"]:checked').value;
            const subinventarioSelector = document.getElementById('subinventarioSelector');
            const subinventarioSelect = document.getElementById('subinventario_id');
            const addLibroBtn = document.getElementById('addLibroBtn');
            const statusMessage = document.getElementById('statusMessage');
            
            logEvent(`Tipo de inventario cambiado a: ${tipoInventario}`);
            
            if (tipoInventario === 'subinventario') {
                subinventarioSelector.style.display = 'block';
                subinventarioSelect.required = true;
                statusMessage.textContent = '✓ Selector de subinventario mostrado';
                logEvent('Selector de subinventario MOSTRADO');
                
                // Deshabilitar botón de agregar libro hasta que se seleccione un subinventario
                if (addLibroBtn) {
                    const hasSubinventarioSelected = subinventarioSelect.value !== '';
                    addLibroBtn.disabled = !hasSubinventarioSelected;
                    if (!hasSubinventarioSelected) {
                        addLibroBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        logEvent('Botón "Agregar Libro" DESHABILITADO (no hay subinventario seleccionado)');
                    } else {
                        addLibroBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        logEvent('Botón "Agregar Libro" HABILITADO');
                    }
                }
            } else {
                subinventarioSelector.style.display = 'none';
                subinventarioSelect.required = false;
                subinventarioSelect.value = '';
                statusMessage.textContent = '';
                logEvent('Selector de subinventario OCULTADO');
                
                // Habilitar botón de agregar libro para inventario general
                if (addLibroBtn) {
                    addLibroBtn.disabled = false;
                    addLibroBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    logEvent('Botón "Agregar Libro" HABILITADO (inventario general)');
                }
            }
        }
        
        function cargarLibrosSubinventario() {
            const subinventarioSelect = document.getElementById('subinventario_id');
            const selectedOption = subinventarioSelect.options[subinventarioSelect.selectedIndex];
            const addLibroBtn = document.getElementById('addLibroBtn');
            const statusMessage = document.getElementById('statusMessage');
            
            if (selectedOption.value) {
                statusMessage.textContent = `✓ Subinventario seleccionado: ${selectedOption.text}`;
                logEvent(`Subinventario seleccionado: ${selectedOption.text}`);
                
                // Habilitar botón de agregar libro
                if (addLibroBtn) {
                    addLibroBtn.disabled = false;
                    addLibroBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    logEvent('Botón "Agregar Libro" HABILITADO');
                }
            } else {
                statusMessage.textContent = '⚠ Selecciona un subinventario para continuar';
                logEvent('Subinventario deseleccionado');
                
                // Deshabilitar botón
                if (addLibroBtn) {
                    addLibroBtn.disabled = true;
                    addLibroBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    logEvent('Botón "Agregar Libro" DESHABILITADO');
                }
            }
        }

        // Inicializar al cargar
        document.addEventListener('DOMContentLoaded', function() {
            toggleInventarioTipo();
            logEvent('Página cargada - Estado inicial configurado');
        });
    </script>
</body>
</html>
